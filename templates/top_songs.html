<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible"content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"rel="stylesheet">
    <link rel="stylesheet" href="/static/top_songs.css">
    <title>Top Songs</title>
</head>
<body>
    <header class="header">
        <div class="header-element">
            <span class="material-icons-outlined">search</span>
            <span id="profile-icon" class="material-icons-outlined">person</span>
        </div>
    </header>

    <section class="sidebar">
        <div class="logo-img">
            <img src="/static/images/statify_logo_cropped.png" alt="statify_logo">
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/home">
                <span class="material-icons-outlined">dashboard</span>
                Dashboard
            </a>
            
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-songs">
                <span class="material-icons-outlined">audiotrack</span>
                Top Songs
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-artists">
                <span class="material-icons-outlined">people</span>
                Top Artists
            </a>
            
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-genres">
                <span class="material-icons-outlined">theater_comedy</span>
                Top Genres
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/logout">
                <span class="material-icons-outlined">logout</span>
                Log Out
            </a>
        </div>
    </section>

    <main class="main" id="main">
        <div class="container"> 
            <div class="instructions">
                <b class="inst-heading">Top 50 Songs</b>
                <p class="inst-paragraph">Here you'll find your top 50 tracks in 3 different time intervals. Choose the one you like!</p>
            </div>
            <div class="fetch">
                <b class="time-range">Time range:</b>
                <select id="fetch-options">
                    <option value="short">4 weeks</option>
                    <option value="medium">6 months</option>
                    <option value="long">~1 year</option>
                </select>
            </div>
            <table id="top-tracks-table">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Artists</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </main>
    
    <script>

document.addEventListener("DOMContentLoaded", function () {
            const selectElement = document.getElementById("fetch-options");
            const topTracksTable = document.getElementById("top-tracks-table").getElementsByTagName('tbody')[0];
    
            selectElement.addEventListener("change", function () {
                const selectedValue = selectElement.value;
                fetch(`/my-top-tracks-${selectedValue}`)
                    .then((response) => response.json())
                    .then((data) => {
                        topTracksTable.innerHTML = ""; 
                        if (data.error) {
                            const errorRow = topTracksTable.insertRow();
                            const errorCell = errorRow.insertCell();
                            errorCell.colSpan = 4;
                            errorCell.textContent = `Error: ${data.error}`;
                        } else {
                            data.items.forEach((track, index) => {
                                const trackRow = topTracksTable.insertRow();
                                const positionCell = trackRow.insertCell();
                                positionCell.textContent = index + 1;
                                const trackImageCell = trackRow.insertCell();
                                const trackImage = document.createElement("img");
                                trackImage.src = track.album.images[0].url;
                                trackImage.alt = `${track.name} cover`;
                                trackImage.classList.add("track-image");
                                trackImageCell.appendChild(trackImage);
                                const trackNameCell = trackRow.insertCell();
                                const trackName = document.createElement("p");
                                trackName.textContent = track.name;
                                trackName.classList.add("track-name");
                                trackNameCell.appendChild(trackName);
                                const trackArtistsCell = trackRow.insertCell();
                                const trackArtists = document.createElement("p");
                                trackArtists.textContent = track.artists.map((artist) => artist.name).join(", ");
                                trackArtists.classList.add("track-artists");
                                trackArtistsCell.appendChild(trackArtists);
                            });
                        }
                    })
                    .catch((error) => {
                        console.error("Error fetching top tracks:", error);
                    });
            });
            selectElement.dispatchEvent(new Event("change"));
        });
    </script>
    
</body>
</html>