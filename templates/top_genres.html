<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="/static/top_genres.css">
    <title>Top Artists</title>
</head>
<body>
    <header class="header">
        <div class="header-element">
            <span class="material-icons-outlined">search</span>
            <span id="profile-icon" class="material-icons-outlined">person</span>
        </div>
    </header>

    <section class="sidebar">
        <div class="logo-img">
            <img src="/static/images/statify_logo_cropped.png" alt="statify_logo">
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/home">
                <span class="material-icons-outlined">dashboard</span>
                Dashboard
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-songs">
                <span class="material-icons-outlined">audiotrack</span>
                Top Songs
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-artists">
                <span class="material-icons-outlined">people</span>
                Top Artists
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/top-genres">
                <span class="material-icons-outlined">theater_comedy</span>
                Top Genres
            </a>
        </div>
        <div class="sidebar-element">
            <a href="http://localhost:8000/logout">
                <span class="material-icons-outlined">logout</span>
                Log Out
            </a>
        </div>
    </section>

    <main class="main" id="main">
        <div class="container"> 
            <div class="instructions">
                <b class="inst-heading">Top 10 Genres</b>
                <p class="inst-paragraph">Here you'll find your top genres in 3 different time intervals. Choose the one you like!</p>
            </div>
            <div class="fetch">
                <b class="time-range">Time range:</b>
                <select id="fetch-options">
                    <option value="short">Short</option>
                    <option value="medium">Medium</option>
                    <option value="long">Long</option>
                </select>
            </div>
            <table id="top-genres-table">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </main>
    
    <script>
document.addEventListener("DOMContentLoaded", function () {
    const selectElement = document.getElementById("fetch-options");
    const topGenresTable = document.getElementById("top-genres-table").getElementsByTagName('tbody')[0];

    selectElement.addEventListener("change", function () {
        const selectedValue = selectElement.value;
        fetch(`/top-genres-${selectedValue}`)
            .then((response) => response.json())
            .then((data) => {
                topGenresTable.innerHTML = "";
                if (data.error) {
                    const errorRow = topGenresTable.insertRow();
                    const errorCell = errorRow.insertCell();
                    errorCell.colSpan = 2;
                    errorCell.textContent = `Error: ${data.error}`;
                } else {
                    const uniqueGenres = [...new Set(data)];
                    const topGenres = uniqueGenres.slice(0, 10);
                    topGenres.forEach((genre, index) => {
                        const genreRow = topGenresTable.insertRow();
                        const positionCell = genreRow.insertCell();
                        positionCell.textContent = index + 1;
                        const genreCell = genreRow.insertCell();
                        genreCell.textContent = genre;
                    });
                }
            })
            .catch((error) => {
                console.error("Error fetching top genres:", error);
            });
    });
    selectElement.dispatchEvent(new Event("change"));
});
    </script>
    
</body>
</html>
